<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>WatchVIM CMS Portal</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              watchBlack: "#0a0a0a",
              watchRed: "#e50914",
              watchGold: "#d4af37",
            },
          },
        },
      };
    </script>

    <!-- Mux Player for previews -->
    <script src="https://unpkg.com/@mux/mux-player"></script>

    <style>
      body {
        background: #0a0a0a;
        color: #ffffff;
      }

      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .focus-ring {
        outline: 2px solid #ffffff;
        outline-offset: 2px;
      }

      input,
      textarea,
      select {
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #e50914;
      }

      .btn-primary {
        background: #e50914;
      }

      .btn-primary:hover {
        background: #b20710;
      }

      .btn-ghost {
        background: rgba(255, 255, 255, 0.08);
      }

      .btn-ghost:hover {
        background: rgba(255, 255, 255, 0.15);
      }
    </style>
  </head>

  <body>
    <div class="min-h-screen flex flex-col bg-watchBlack text-white">
      <!-- HEADER -->
      <header
        class="border-b border-white/10 bg-watchBlack/95 backdrop-blur sticky top-0 z-20"
      >
        <div
          class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-3"
        >
          <div class="flex items-center gap-2">
            <div
              class="h-8 w-8 rounded bg-gradient-to-br from-watchRed to-watchGold flex items-center justify-center text-xs font-black"
            >
              V
            </div>
            <div>
              <div class="font-black tracking-wide text-sm md:text-base">
                WatchVIM CMS Portal
              </div>
              <div class="text-[11px] text-white/60">
                Manifest → Stable Catalog editor & LIVE channel programmer
              </div>
            </div>
          </div>

          <div class="text-xs text-white/60 text-right">
            <div>Membership reference: $5.99 / month • $45.99 / year</div>
            <div id="envLabel" class="text-[10px] uppercase tracking-wide">
              Catalog: local (not loaded)
            </div>
          </div>
        </div>
      </header>

      <!-- MAIN -->
      <main class="flex-1">
        <div class="max-w-6xl mx-auto px-4 py-4 md:py-6 space-y-4">
          <!-- TAB NAV -->
          <nav
            class="inline-flex rounded-xl border border-white/10 bg-white/5 p-1 text-xs md:text-sm"
          >
            <button
              id="tabBtnTitles"
              class="cms-tab-btn px-3 py-2 rounded-lg bg-white/15"
              data-tab="titles"
            >
              Titles
            </button>
            <button
              id="tabBtnLive"
              class="cms-tab-btn px-3 py-2 rounded-lg text-white/70 hover:bg-white/10"
              data-tab="live"
            >
              LIVE / Loop Channel
            </button>
            <button
              id="tabBtnSettings"
              class="cms-tab-btn px-3 py-2 rounded-lg text-white/70 hover:bg-white/10"
              data-tab="settings"
            >
              Platform Settings
            </button>
          </nav>

          <!-- TITLES TAB -->
          <section id="tabTitles" class="space-y-4">
            <div
              class="grid grid-cols-1 lg:grid-cols-[260px,1fr] gap-4 items-start"
            >
              <!-- LEFT: TITLE LIST / CATALOG -->
              <aside
                class="bg-white/5 border border-white/10 rounded-xl p-3 flex flex-col gap-3"
              >
                <div class="flex items-center justify-between gap-2">
                  <div class="text-xs font-semibold uppercase tracking-wide">
                    Titles
                  </div>
                  <button
                    id="btnNewTitle"
                    class="btn-ghost text-xs px-2 py-1 rounded-lg flex items-center gap-1"
                    type="button"
                  >
                    <span class="text-lg leading-none">＋</span>
                    <span>New</span>
                  </button>
                </div>

                <div class="space-y-2">
                  <input
                    id="filterTitles"
                    type="text"
                    placeholder="Search titles…"
                    class="w-full px-3 py-2 rounded-lg text-xs"
                  />
                  <div
                    id="titleList"
                    class="no-scrollbar overflow-y-auto max-h-[65vh] text-xs space-y-1"
                  >
                    <!-- Filled via JS -->
                  </div>
                </div>

                <div class="border-t border-white/10 pt-3 space-y-2">
                  <div class="text-[11px] text-white/60">
                    Catalog JSON tools
                  </div>
                  <div class="flex flex-col gap-2 text-xs">
                    <button
                      id="btnLoadCatalog"
                      type="button"
                      class="btn-ghost w-full px-3 py-1.5 rounded-lg"
                    >
                      Load catalog from server
                    </button>
                    <button
                      id="btnExportCatalog"
                      type="button"
                      class="btn-ghost w-full px-3 py-1.5 rounded-lg"
                    >
                      Download updated catalog.json
                    </button>
                  </div>
                  <p class="text-[11px] text-white/50">
                    After downloading, upload catalog.json to your Vercel Blob
                    storage and update the manifest’s <code>stableCatalogUrl</code>.
                  </p>
                </div>
              </aside>

              <!-- RIGHT: TITLE FORM -->
              <section
                id="titleFormSection"
                class="bg-white/5 border border-white/10 rounded-xl p-4 md:p-5"
              >
                <div
                  id="titleFormEmpty"
                  class="text-sm text-white/70 flex items-center justify-center min-h-[200px]"
                >
                  Select a title on the left or create a new title to begin.
                </div>

                <form
                  id="titleForm"
                  class="space-y-4 text-xs md:text-sm hidden"
                  autocomplete="off"
                >
                  <div class="flex items-start justify-between gap-3">
                    <div>
                      <div class="text-xs font-semibold uppercase">
                        Title Details
                      </div>
                      <div class="text-[11px] text-white/60">
                        Configure metadata, images, monetization & hero
                        carousel.
                      </div>
                    </div>
                    <div class="flex gap-2">
                      <button
                        id="btnDeleteTitle"
                        type="button"
                        class="btn-ghost px-3 py-1.5 rounded-lg text-[11px]"
                      >
                        Delete
                      </button>
                      <button
                        id="btnSaveTitle"
                        type="submit"
                        class="btn-primary px-3 py-1.5 rounded-lg text-[11px]"
                      >
                        Save
                      </button>
                    </div>
                  </div>

                  <!-- ID + TYPE -->
                  <div
                    class="grid grid-cols-1 md:grid-cols-3 gap-3 items-start"
                  >
                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold"
                        >Title ID (slug)</label
                      >
                      <input
                        id="fieldId"
                        type="text"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="scottsdale-s1"
                      />
                      <p class="text-[10px] text-white/60">
                        Used as primary key in the catalog JSON.
                      </p>
                    </div>

                    <div class="space-y-1 md:col-span-2">
                      <label class="text-[11px] font-semibold">Title</label>
                      <input
                        id="fieldTitle"
                        type="text"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="Scottsdale: Season 1"
                      />
                    </div>
                  </div>

                  <div
                    class="grid grid-cols-1 md:grid-cols-4 gap-3 items-start"
                  >
                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold"
                        >Content Type</label
                      >
                      <select
                        id="fieldType"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                      >
                        <option value="films">Film</option>
                        <option value="documentaries">Documentary</option>
                        <option value="series">Series</option>
                        <option value="shorts">Short</option>
                        <option value="foreign">Foreign</option>
                      </select>
                    </div>

                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold"
                        >Release Year</label
                      >
                      <input
                        id="fieldReleaseYear"
                        type="number"
                        min="1900"
                        max="2100"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="2025"
                      />
                    </div>

                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold"
                        >Runtime (mins)</label
                      >
                      <input
                        id="fieldRuntime"
                        type="number"
                        min="0"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="90"
                      />
                    </div>

                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold">Rating</label>
                      <input
                        id="fieldRating"
                        type="text"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="TV-MA, R, PG-13…"
                      />
                    </div>
                  </div>

                  <div
                    class="grid grid-cols-1 md:grid-cols-3 gap-3 items-start"
                  >
                    <div class="space-y-1 md:col-span-2">
                      <label class="text-[11px] font-semibold"
                        >Short Logline / Synopsis</label
                      >
                      <textarea
                        id="fieldSynopsis"
                        rows="2"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="A scandalous drama set in Scottsdale, Arizona…"
                      ></textarea>
                    </div>
                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold">Language</label>
                      <input
                        id="fieldLanguage"
                        type="text"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="English, Spanish…"
                      />
                    </div>
                  </div>

                  <div
                    class="grid grid-cols-1 md:grid-cols-2 gap-3 items-start"
                  >
                    <div class="space-y-1">
                      <label class="text-[11px] font-semibold"
                        >Description</label
                      >
                      <textarea
                        id="fieldDescription"
                        rows="3"
                        class="w-full px-3 py-2 rounded-lg text-xs"
                        placeholder="Long description / marketing copy…"
                      ></textarea>
                    </div>

                    <div class="space-y-3">
                      <div class="space-y-1">
                        <label class="text-[11px] font-semibold"
                          >Genres (comma separated)</label
                        >
                        <input
                          id="fieldGenres"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="Drama, Romance, LGBTQ+"
                        />
                      </div>

                      <div class="space-y-1">
                        <label class="text-[11px] font-semibold"
                          >Tags (comma separated)</label
                        >
                        <input
                          id="fieldTags"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="featured, hero, arizona"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- HERO CAROUSEL FLAGS -->
                  <div
                    class="grid grid-cols-1 md:grid-cols-3 gap-3 items-center border border-white/10 rounded-lg p-3"
                  >
                    <div class="space-y-1 md:col-span-2">
                      <div class="text-[11px] font-semibold">
                        Hero Carousel (Home page)
                      </div>
                      <p class="text-[11px] text-white/60">
                        Mark this title as a hero item to appear in the
                        fullscreen carousel on the home page. Lower hero order
                        shows earlier.
                      </p>
                    </div>
                    <div class="space-y-2">
                      <label class="flex items-center gap-2 text-[11px]">
                        <input
                          id="fieldIsHero"
                          type="checkbox"
                          class="h-3 w-3"
                        />
                        <span>Show in hero carousel</span>
                      </label>
                      <div class="flex items-center gap-2">
                        <span class="text-[11px]">Hero Order</span>
                        <input
                          id="fieldHeroOrder"
                          type="number"
                          class="w-20 px-2 py-1 rounded-lg text-[11px]"
                          placeholder="1"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- IMAGES (Vercel Blob URLs) -->
                  <div
                    class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px]"
                  >
                    <div class="flex items-center justify-between gap-2">
                      <div>
                        <div class="font-semibold">Images / Artwork</div>
                        <div class="text-white/60">
                          Paste image URLs from your Vercel Blob storage.
                        </div>
                      </div>
                    </div>

                    <div
                      class="grid grid-cols-1 md:grid-cols-2 gap-3 items-start pt-2"
                    >
                      <div class="space-y-1">
                        <label class="font-semibold">TV Poster URL</label>
                        <input
                          id="fieldTvPoster"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="https://blob.vercel-storage.com/...-tv-poster-2x3.png"
                        />
                        <p class="text-[10px] text-white/60">
                          Used on TV / desktop hero rows.
                        </p>
                      </div>
                      <div class="space-y-1">
                        <label class="font-semibold">Mobile Poster URL</label>
                        <input
                          id="fieldMobilePoster"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="https://blob.vercel-storage.com/...-mobile-poster-2x3.png"
                        />
                        <p class="text-[10px] text-white/60">
                          Used on mobile rows & detail pages.
                        </p>
                      </div>
                      <div class="space-y-1">
                        <label class="font-semibold">TV Hero Image URL</label>
                        <input
                          id="fieldTvHero"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="https://blob.vercel-storage.com/...-tv-hero-16x9.jpg"
                        />
                        <p class="text-[10px] text-white/60">
                          16:9 hero image for TV home hero carousel.
                        </p>
                      </div>
                      <div class="space-y-1">
                        <label class="font-semibold"
                          >Mobile Hero Image URL</label
                        >
                        <input
                          id="fieldMobileHero"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="https://blob.vercel-storage.com/...-mobile-hero-9x16.jpg"
                        />
                        <p class="text-[10px] text-white/60">
                          9:16 / 16:9 hero for mobile home hero.
                        </p>
                      </div>
                      <div class="space-y-1 md:col-span-2">
                        <label class="font-semibold"
                          >Title Logo PNG (transparent)</label
                        >
                        <input
                          id="fieldTitleLogo"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="https://blob.vercel-storage.com/...-title-logo-transparent.png"
                        />
                        <p class="text-[10px] text-white/60">
                          Optional transparent PNG logo shown over hero image on
                          frontend.
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- MUX PLAYBACK IDS + PREVIEW -->
                  <div
                    class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px]"
                  >
                    <div class="flex items-center justify-between gap-2">
                      <div>
                        <div class="font-semibold">
                          Mux Playback IDs (video source)
                        </div>
                        <div class="text-white/60">
                          Use Mux playback IDs for main content & trailers.
                        </div>
                      </div>
                    </div>

                    <div
                      class="grid grid-cols-1 md:grid-cols-2 gap-3 items-start pt-2"
                    >
                      <div class="space-y-1">
                        <label class="font-semibold"
                          >Content Playback ID</label
                        >
                        <div class="flex gap-2">
                          <input
                            id="fieldContentPlaybackId"
                            type="text"
                            class="flex-1 px-3 py-2 rounded-lg text-xs"
                            placeholder="muxContentPlaybackId123"
                          />
                          <button
                            type="button"
                            id="btnPreviewContent"
                            class="btn-ghost px-3 py-2 rounded-lg text-[11px]"
                          >
                            Preview
                          </button>
                        </div>
                        <p class="text-[10px] text-white/60">
                          Used when user presses "Watch" (subject to paywall).
                        </p>
                      </div>
                      <div class="space-y-1">
                        <label class="font-semibold"
                          >Trailer Playback ID</label
                        >
                        <div class="flex gap-2">
                          <input
                            id="fieldTrailerPlaybackId"
                            type="text"
                            class="flex-1 px-3 py-2 rounded-lg text-xs"
                            placeholder="muxTrailerPlaybackId456"
                          />
                          <button
                            type="button"
                            id="btnPreviewTrailer"
                            class="btn-ghost px-3 py-2 rounded-lg text-[11px]"
                          >
                            Preview
                          </button>
                        </div>
                        <p class="text-[10px] text-white/60">
                          Used for hero auto-play trailer & "Play Trailer"
                          button.
                        </p>
                      </div>
                    </div>

                    <div
                      id="muxPreview"
                      class="mt-3 rounded-lg border border-white/10 bg-black/60 p-2 hidden"
                    >
                      <!-- filled by JS -->
                    </div>
                  </div>

                  <!-- MONETIZATION -->
                  <div
                    class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px]"
                  >
                    <div class="font-semibold">Monetization (AVOD/SVOD/TVOD)</div>
                    <p class="text-white/60">
                      These flags drive the frontend paywall. "Watch Now with
                      Ads" only appears when a title is AVOD-only (no SVOD / TVOD).
                    </p>

                    <div
                      class="grid grid-cols-1 md:grid-cols-3 gap-3 items-start pt-2"
                    >
                      <div class="space-y-2">
                        <label class="flex items-center gap-2">
                          <input
                            id="fieldMonetAvod"
                            type="checkbox"
                            class="h-3 w-3"
                          />
                          <span>AVOD (free with ads)</span>
                        </label>
                        <label class="flex items-center gap-2">
                          <input
                            id="fieldMonetSvod"
                            type="checkbox"
                            class="h-3 w-3"
                          />
                          <span>SVOD (subscription)</span>
                        </label>
                        <label class="flex items-center gap-2">
                          <input
                            id="fieldMonetTvodEnabled"
                            type="checkbox"
                            class="h-3 w-3"
                          />
                          <span>TVOD (rent / buy)</span>
                        </label>
                      </div>

                      <div class="space-y-1">
                        <label class="font-semibold"
                          >TVOD Default Price (USD)</label
                        >
                        <input
                          id="fieldTvodPrice"
                          type="text"
                          class="w-full px-3 py-2 rounded-lg text-xs"
                          placeholder="9.99"
                        />
                        <p class="text-[10px] text-white/60">
                          Optional base price if you’re not splitting rent/buy.
                        </p>
                      </div>

                      <div class="space-y-1">
                        <label class="font-semibold"
                          >TVOD Rent / Buy (optional)</label
                        >
                        <div class="flex gap-2">
                          <input
                            id="fieldTvodRentPrice"
                            type="text"
                            class="w-1/2 px-3 py-2 rounded-lg text-xs"
                            placeholder="3.99"
                          />
                          <input
                            id="fieldTvodBuyPrice"
                            type="text"
                            class="w-1/2 px-3 py-2 rounded-lg text-xs"
                            placeholder="9.99"
                          />
                        </div>
                        <p class="text-[10px] text-white/60">
                          Frontend uses these values to build TVOD checkout
                          URLs.
                        </p>
                      </div>
                    </div>

                    <p class="text-[10px] text-white/50">
                      Example: AVOD-only = free with ads; SVOD titles require
                      membership; TVOD-only titles require rent/buy before
                      playback.
                    </p>
                  </div>

                  <!-- SERIES-ONLY: SEASONS JSON -->
                  <div
                    id="seriesSeasonsBlock"
                    class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px] hidden"
                  >
                    <div class="font-semibold">Series Seasons / Episodes</div>
                    <p class="text-white/60">
                      Advanced: paste or edit JSON describing seasons and
                      episodes. The frontend automatically attaches
                      <code>__seriesId</code> and uses series-level monetization
                      when episode monetization is omitted.
                    </p>
                    <textarea
                      id="fieldSeasonsJson"
                      rows="6"
                      class="w-full px-3 py-2 rounded-lg text-[11px] font-mono"
                      placeholder='[
  {
    "seasonNumber": 1,
    "episodes": [
      {
        "id": "scottsdale_s1e1",
        "title": "Pilot",
        "episodeNumber": 1,
        "contentPlaybackId": "muxPlaybackIdForEpisode1"
      }
    ]
  }
]'
                    ></textarea>
                  </div>
                </form>
              </section>
            </div>
          </section>

          <!-- LIVE / LOOP TAB -->
          <section id="tabLive" class="hidden space-y-4">
            <div
              class="bg-white/5 border border-white/10 rounded-xl p-4 md:p-5 space-y-4 text-xs md:text-sm"
            >
              <div class="flex items-center justify-between gap-2">
                <div>
                  <div class="font-semibold text-sm">LIVE / Loop Channel</div>
                  <div class="text-[11px] text-white/60">
                    Configure the continuous "LIVE" loop channel used by the
                    frontend. Viewers cannot skip to the next title; they only
                    see upcoming items in the sidebar.
                  </div>
                </div>
                <button
                  id="btnSaveLoop"
                  type="button"
                  class="btn-primary px-3 py-1.5 rounded-lg text-[11px]"
                >
                  Save LIVE config
                </button>
              </div>

              <div
                class="grid grid-cols-1 md:grid-cols-[2fr,1.2fr] gap-4 items-start"
              >
                <!-- LEFT: SETTINGS -->
                <div class="space-y-3">
                  <div
                    class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px]"
                  >
                    <div class="font-semibold">Rotation Settings</div>
                    <div
                      class="grid grid-cols-1 md:grid-cols-3 gap-3 items-center pt-2"
                    >
                      <label class="flex items-center gap-2">
                        <input
                          id="fieldLoopShuffle"
                          type="checkbox"
                          class="h-3 w-3"
                        />
                        <span>Shuffle rotation</span>
                      </label>
                      <div class="flex items-center gap-2">
                        <span>Ad frequency (mins)</span>
                        <input
                          id="fieldLoopAdFreq"
                          type="number"
                          min="0"
                          class="w-20 px-2 py-1 rounded-lg text-[11px]"
                          placeholder="12"
                        />
                      </div>
                      <p class="text-[10px] text-white/60 md:text-right">
                        0 = disable ads.
                      </p>
                    </div>
                  </div>

                  <div
                    class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px]"
                  >
                    <div class="flex items-center justify-between gap-2">
                      <div>
                        <div class="font-semibold">Rotation Items</div>
                        <div class="text-white/60">
                          JSON array of items to rotate. Each item references a
                          title or episode ID from the catalog.
                        </div>
                      </div>
                      <div class="flex gap-2">
                        <select
                          id="fieldLoopAddTitle"
                          class="px-2 py-1 rounded-lg text-[11px] max-w-[180px]"
                        >
                          <!-- filled via JS -->
                        </select>
                        <button
                          type="button"
                          id="btnLoopAddTitle"
                          class="btn-ghost px-3 py-1.5 rounded-lg text-[11px]"
                        >
                          Add title
                        </button>
                      </div>
                    </div>
                    <textarea
                      id="fieldLoopRotationJson"
                      rows="8"
                      class="w-full px-3 py-2 rounded-lg text-[11px] font-mono"
                      placeholder='[
  { "refType": "title", "refId": "scottsdale-s1", "label": "Scottsdale — S1 Marathon" },
  { "refType": "title", "refId": "almost-us", "label": "Almost Us" }
]'
                    ></textarea>
                  </div>
                </div>

                <!-- RIGHT: ADS -->
                <div
                  class="border border-white/10 rounded-lg p-3 space-y-2 text-[11px]"
                >
                  <div class="font-semibold">Sponsored Ads (optional)</div>
                  <p class="text-white/60">
                    JSON array describing pre-programmed ads that can appear in
                    the LIVE loop between content blocks.
                  </p>
                  <textarea
                    id="fieldLoopAdsJson"
                    rows="14"
                    class="w-full px-3 py-2 rounded-lg text-[11px] font-mono"
                    placeholder='[
  {
    "name": "Brand Spot 30s",
    "muxAdPlaybackId": "adPlaybackId123",
    "durationSec": 30,
    "clickUrl": "https://brand.com"
  }
]'
                  ></textarea>
                  <p class="text-[10px] text-white/50">
                    Frontend uses <code>muxAdPlaybackId</code> or
                    <code>mediaUrl</code> for playback and displays
                    <code>name</code> + <code>clickUrl</code> if provided.
                  </p>
                </div>
              </div>
            </div>
          </section>

          <!-- SETTINGS TAB -->
          <section id="tabSettings" class="hidden space-y-4">
            <div
              class="bg-white/5 border border-white/10 rounded-xl p-4 md:p-5 space-y-3 text-xs md:text-sm"
            >
              <div class="font-semibold text-sm">
                Platform Settings (reference)
              </div>
              <p class="text-white/70">
                These settings are stored in
                <code>config.json</code> for the frontend and not directly
                written by this CMS, but they’re listed here so you keep
                everything aligned.
              </p>

              <div
                class="grid grid-cols-1 md:grid-cols-2 gap-3 items-start pt-2"
              >
                <div class="space-y-1">
                  <label class="text-[11px] font-semibold"
                    >Stable Catalog URL</label
                  >
                  <input
                    id="fieldSettingsCatalogUrl"
                    type="text"
                    class="w-full px-3 py-2 rounded-lg text-xs"
                    placeholder="https://...vercel-storage.com/catalog-stable.json"
                  />
                  <p class="text-[10px] text-white/60">
                    This should match the URL referenced by your manifest’s
                    <code>stableCatalogUrl</code> and your frontend
                    configuration.
                  </p>
                </div>

                <div class="space-y-1">
                  <label class="text-[11px] font-semibold">VAST Tag</label>
                  <input
                    id="fieldSettingsVastTag"
                    type="text"
                    class="w-full px-3 py-2 rounded-lg text-xs"
                    placeholder="https://adserver.com/vast?slot=watchvim"
                  />
                  <p class="text-[10px] text-white/60">
                    Optional global pre-roll tag used by the frontend for AVOD
                    & TVOD content.
                  </p>
                </div>

                <div class="space-y-1">
                  <label class="text-[11px] font-semibold"
                    >TVOD Checkout Base URL</label
                  >
                  <input
                    id="fieldSettingsTvodBase"
                    type="text"
                    class="w-full px-3 py-2 rounded-lg text-xs"
                    placeholder="https://watchvim.com/checkout.html"
                  />
                  <p class="text-[10px] text-white/60">
                    The frontend app builds checkout links like
                    <code>?mode=tvod&amp;titleId=…&amp;amount=…</code> on top of
                    this base.
                  </p>
                </div>

                <div class="space-y-1">
                  <label class="text-[11px] font-semibold"
                    >Membership Prices (reference)</label
                  >
                  <div
                    class="px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-[11px]"
                  >
                    Monthly: <b>$5.99</b> &nbsp;•&nbsp; Annual:
                    <b>$45.99</b>
                    <p class="mt-1 text-white/60">
                      Ensure your payment processor & marketing match these
                      numbers.
                    </p>
                  </div>
                </div>
              </div>

              <p class="text-[10px] text-white/50">
                You’ll still maintain
                <code>config.json</code> manually or via your DevOps process,
                but this view helps keep your CMS operator aligned with your
                OTT frontend configuration.
              </p>
            </div>
          </section>
        </div>
      </main>

      <footer
        class="px-4 md:px-8 py-4 border-t border-white/10 text-[11px] text-white/50"
      >
        <div
          class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-2"
        >
          <div>© WatchVIM CMS — VIM Media, LLC</div>
          <div class="flex gap-3">
            <a href="/privacy.html" class="hover:text-white">Privacy</a>
            <a href="/terms.html" class="hover:text-white">Terms</a>
          </div>
        </div>
      </footer>
    </div>

    <!-- CMS SCRIPT -->
    <script>
      // ------------------------------------------------------------------
      // BASIC CONFIG
      // ------------------------------------------------------------------
      // OPTIONAL: set this to your Vercel Blob stable catalog URL
      // to allow "Load catalog from server" from this portal.
      const CATALOG_URL = ""; // e.g. "https://...vercel-storage.com/catalog-stable.json"

      const state = {
        catalog: {
          titles: [],
          loopChannel: {},
          settings: {},
        },
        selectedTitleId: null,
        activeTab: "titles",
      };

      // ------------------------------------------------------------------
      // HELPERS
      // ------------------------------------------------------------------
      function $(id) {
        return document.getElementById(id);
      }

      function escHtml(str) {
        return String(str || "").replace(
          /[&<>"/]/g,
          (c) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "/": "&#47;",
            })[c] || c
        );
      }

      function asArrayFromCsv(str) {
        if (!str) return [];
        return String(str)
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean);
      }

      function csvFromArray(arr) {
        return (arr || []).join(", ");
      }

      function toNumberOrNull(value) {
        if (value === "" || value === null || value === undefined) return null;
        const n = Number(value);
        return Number.isFinite(n) ? n : null;
      }

      function downloadFile(filename, text) {
        const blob = new Blob([text], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      // ------------------------------------------------------------------
      // TAB SWITCHING
      // ------------------------------------------------------------------
      function setActiveTab(name) {
        state.activeTab = name;

        ["tabTitles", "tabLive", "tabSettings"].forEach((id) => {
          const el = $(id);
          if (!el) return;
          el.classList.toggle("hidden", id !== "tab" + name[0].toUpperCase() + name.slice(1));
        });

        document.querySelectorAll(".cms-tab-btn").forEach((btn) => {
          const tab = btn.getAttribute("data-tab");
          const active = tab === name;
          btn.classList.toggle("bg-white/15", active);
          btn.classList.toggle("text-white/70", !active);
        });
      }

      // ------------------------------------------------------------------
      // TITLES LIST & FORM
      // ------------------------------------------------------------------
      function renderTitleList() {
        const container = $("titleList");
        const filter = $("filterTitles").value.toLowerCase();
        const titles = state.catalog.titles || [];

        if (!titles.length) {
          container.innerHTML =
            '<div class="text-[11px] text-white/60 py-2">No titles yet. Click “New” to create one.</div>';
          return;
        }

        const items = titles
          .slice()
          .sort((a, b) => (a.title || "").localeCompare(b.title || ""))
          .filter((t) => {
            if (!filter) return true;
            const text = (t.title || t.id || "").toLowerCase();
            return text.includes(filter);
          });

        if (!items.length) {
          container.innerHTML =
            '<div class="text-[11px] text-white/60 py-2">No matching titles found.</div>';
          return;
        }

        container.innerHTML = items
          .map((t) => {
            const selected = t.id === state.selectedTitleId;
            return `
              <button
                type="button"
                class="w-full text-left px-2 py-1.5 rounded-lg text-[11px] ${
                  selected ? "bg-white/20" : "hover:bg-white/10"
                }"
                data-title-id="${escHtml(t.id)}"
              >
                <div class="font-semibold line-clamp-1">${escHtml(
                  t.title || "(Untitled)"
                )}</div>
                <div class="text-white/50 flex justify-between gap-1">
                  <span>${escHtml(t.type || "unknown")}</span>
                  <span>${escHtml(t.releaseYear || "")}</span>
                </div>
              </button>
            `;
          })
          .join("");

        container.querySelectorAll("[data-title-id]").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-title-id");
            selectTitle(id);
          });
        });

        // Fill LIVE dropdown with titles
        const loopSelect = $("fieldLoopAddTitle");
        if (loopSelect) {
          loopSelect.innerHTML =
            '<option value="">+ Add title to rotation</option>' +
            titles
              .slice()
              .sort((a, b) => (a.title || "").localeCompare(b.title || ""))
              .map(
                (t) =>
                  `<option value="${escHtml(t.id)}">${escHtml(
                    t.title || t.id
                  )}</option>`
              )
              .join("");
        }
      }

      function selectTitle(id) {
        const t =
          (state.catalog.titles || []).find((x) => x.id === id) || null;
        state.selectedTitleId = t ? t.id : null;

        if (!t) {
          $("titleForm").classList.add("hidden");
          $("titleFormEmpty").classList.remove("hidden");
          return;
        }

        $("titleFormEmpty").classList.add("hidden");
        $("titleForm").classList.remove("hidden");

        // Basic fields
        $("fieldId").value = t.id || "";
        $("fieldTitle").value = t.title || "";
        $("fieldType").value = t.type || "films";
        $("fieldReleaseYear").value = t.releaseYear || "";
        $("fieldRuntime").value = t.runtimeMins || "";
        $("fieldRating").value = t.rating || "";
        $("fieldSynopsis").value = t.synopsis || "";
        $("fieldDescription").value = t.description || "";
        $("fieldLanguage").value = t.language || "";
        $("fieldGenres").value = csvFromArray(t.genre);
        $("fieldTags").value = csvFromArray(t.tags);

        // Hero
        $("fieldIsHero").checked = !!t.isHero;
        $("fieldHeroOrder").value =
          t.heroOrder ?? t.featuredOrder ?? t.featuredRank ?? "";

        // Images
        const imgs = t.appImages || {};
        $("fieldTvPoster").value = imgs.tvPosterUrl || t.posterUrl || "";
        $("fieldMobilePoster").value =
          imgs.mobilePosterUrl || t.mobilePosterUrl || "";
        $("fieldTvHero").value = imgs.tvHeroUrl || t.heroUrl || "";
        $("fieldMobileHero").value =
          imgs.mobileHeroUrl || t.mobileHeroUrl || "";
        $("fieldTitleLogo").value =
          imgs.titleLogoUrl || t.titleLogoUrl || "";

        // Mux IDs
        $("fieldContentPlaybackId").value = t.contentPlaybackId || "";
        $("fieldTrailerPlaybackId").value = t.trailerPlaybackId || "";
        const muxPreview = $("muxPreview");
        muxPreview.classList.add("hidden");
        muxPreview.innerHTML = "";

        // Monetization
        const monet = t.monetization || {};
        const tvod = monet.tvod || {};
        $("fieldMonetAvod").checked = !!monet.avod;
        $("fieldMonetSvod").checked = !!monet.svod;
        $("fieldMonetTvodEnabled").checked = !!tvod.enabled;
        $("fieldTvodPrice").value = tvod.price || "";
        $("fieldTvodRentPrice").value = tvod.rentPrice || "";
        $("fieldTvodBuyPrice").value = tvod.buyPrice || "";

        // Series seasons JSON
        const isSeries = t.type === "series";
        $("seriesSeasonsBlock").classList.toggle("hidden", !isSeries);
        $("fieldSeasonsJson").value = isSeries
          ? JSON.stringify(t.seasons || [], null, 2)
          : "";

        // Update env label w/ selected
        const env = $("envLabel");
        env.textContent = CATALOG_URL
          ? "Catalog loaded — editing: " + (t.title || t.id)
          : "Local catalog — editing: " + (t.title || t.id);
      }

      function collectTitleFromForm() {
        const id = $("fieldId").value.trim();
        const title = $("fieldTitle").value.trim();
        const type = $("fieldType").value || "films";

        if (!id) {
          alert("Title ID (slug) is required.");
          return null;
        }
        if (!title) {
          alert("Title is required.");
          return null;
        }

        const releaseYear = toNumberOrNull($("fieldReleaseYear").value);
        const runtimeMins = toNumberOrNull($("fieldRuntime").value);

        const isHero = $("fieldIsHero").checked;
        const heroOrder = toNumberOrNull($("fieldHeroOrder").value);

        const tvPosterUrl = $("fieldTvPoster").value.trim();
        const mobilePosterUrl = $("fieldMobilePoster").value.trim();
        const tvHeroUrl = $("fieldTvHero").value.trim();
        const mobileHeroUrl = $("fieldMobileHero").value.trim();
        const titleLogoUrl = $("fieldTitleLogo").value.trim();

        const contentPlaybackId = $("fieldContentPlaybackId").value.trim();
        const trailerPlaybackId = $("fieldTrailerPlaybackId").value.trim();

        const monetAvod = $("fieldMonetAvod").checked;
        const monetSvod = $("fieldMonetSvod").checked;
        const monetTvodEnabled = $("fieldMonetTvodEnabled").checked;
        const tvodPrice = $("fieldTvodPrice").value.trim();
        const tvodRentPrice = $("fieldTvodRentPrice").value.trim();
        const tvodBuyPrice = $("fieldTvodBuyPrice").value.trim();

        const genre = asArrayFromCsv($("fieldGenres").value);
        const tags = asArrayFromCsv($("fieldTags").value);

        const language = $("fieldLanguage").value.trim();
        const rating = $("fieldRating").value.trim();
        const synopsis = $("fieldSynopsis").value.trim();
        const description = $("fieldDescription").value.trim();

        const seasonsText = $("fieldSeasonsJson").value.trim();
        let seasons = undefined;
        if (type === "series" && seasonsText) {
          try {
            const parsed = JSON.parse(seasonsText);
            if (!Array.isArray(parsed))
              throw new Error("Seasons JSON must be an array.");
            seasons = parsed;
          } catch (err) {
            alert("Invalid Seasons JSON: " + err.message);
            return null;
          }
        }

        const titleObj = {
          id,
          title,
          type,
          releaseYear: releaseYear || undefined,
          runtimeMins: runtimeMins || undefined,
          rating: rating || undefined,
          synopsis: synopsis || undefined,
          description: description || undefined,
          language: language || undefined,
          genre,
          tags,
          isHero,
          heroOrder: heroOrder ?? undefined,
          appImages: {
            tvPosterUrl: tvPosterUrl || undefined,
            mobilePosterUrl: mobilePosterUrl || undefined,
            tvHeroUrl: tvHeroUrl || undefined,
            mobileHeroUrl: mobileHeroUrl || undefined,
            titleLogoUrl: titleLogoUrl || undefined,
          },
          posterUrl: tvPosterUrl || mobilePosterUrl || undefined,
          heroUrl: tvHeroUrl || mobileHeroUrl || undefined,
          titleLogoUrl: titleLogoUrl || undefined,
          contentPlaybackId: contentPlaybackId || undefined,
          trailerPlaybackId: trailerPlaybackId || undefined,
          monetization: {
            avod: monetAvod,
            svod: monetSvod,
            tvod: {
              enabled: monetTvodEnabled,
              price: tvodPrice || undefined,
              rentPrice: tvodRentPrice || undefined,
              buyPrice: tvodBuyPrice || undefined,
            },
          },
        };

        if (type === "series") {
          titleObj.seasons = seasons || [];
        }

        return titleObj;
      }

      function saveTitleFromForm() {
        const t = collectTitleFromForm();
        if (!t) return;

        const titles = state.catalog.titles || [];
        const idx = titles.findIndex((x) => x.id === t.id);

        if (idx >= 0) {
          titles[idx] = t;
        } else {
          titles.push(t);
        }

        state.catalog.titles = titles;
        state.selectedTitleId = t.id;
        renderTitleList();
        selectTitle(t.id);
        alert("Title saved in local catalog. Remember to export catalog.json.");
      }

      function createNewTitle() {
        const newId = "new-title-" + Date.now();
        const newTitle = {
          id: newId,
          title: "Untitled",
          type: "films",
          releaseYear: new Date().getFullYear(),
          runtimeMins: 90,
          monetization: { avod: false, svod: true, tvod: { enabled: false } },
        };
        state.catalog.titles = state.catalog.titles || [];
        state.catalog.titles.push(newTitle);
        renderTitleList();
        selectTitle(newId);
      }

      function deleteCurrentTitle() {
        if (!state.selectedTitleId) return;
        const id = state.selectedTitleId;
        if (!confirm("Delete title \"" + id + "\" from catalog?")) return;

        const titles = state.catalog.titles || [];
        const next = titles.filter((t) => t.id !== id);
        state.catalog.titles = next;
        state.selectedTitleId = null;
        $("titleForm").classList.add("hidden");
        $("titleFormEmpty").classList.remove("hidden");
        renderTitleList();
      }

      // ------------------------------------------------------------------
      // CATALOG LOAD / EXPORT
      // ------------------------------------------------------------------
      async function loadCatalogFromServer() {
        if (!CATALOG_URL) {
          alert(
            "CATALOG_URL is empty. Set it at the top of the script to your stable catalog URL."
          );
          return;
        }

        try {
          const res = await fetch(CATALOG_URL + "?t=" + Date.now(), {
            cache: "no-store",
          });
          if (!res.ok) throw new Error("HTTP " + res.status);
          const json = await res.json();
          state.catalog = {
            titles: json.titles || json.publishedTitles || [],
            loopChannel: json.loopChannel || {},
            settings: json.settings || {},
          };
          state.selectedTitleId = null;
          $("titleForm").classList.add("hidden");
          $("titleFormEmpty").classList.remove("hidden");

          renderTitleList();
          renderLoopEditor();
          renderSettings();

          $("envLabel").textContent =
            "Catalog loaded from server (" + CATALOG_URL + ")";
          alert("Catalog loaded from server.");
        } catch (err) {
          console.error(err);
          alert("Failed to load catalog: " + err.message);
        }
      }

      function exportCatalogJson() {
        const out = {
          titles: state.catalog.titles || [],
          loopChannel: state.catalog.loopChannel || {},
          settings: state.catalog.settings || {},
        };
        downloadFile("catalog.json", JSON.stringify(out, null, 2));
      }

      // ------------------------------------------------------------------
      // LIVE / LOOP EDITOR
      // ------------------------------------------------------------------
      function renderLoopEditor() {
        const loop = state.catalog.loopChannel || {};
        $("fieldLoopShuffle").checked = !!loop.shuffle;
        $("fieldLoopAdFreq").value = loop.adFrequencyMins ?? 12;
        $("fieldLoopRotationJson").value = JSON.stringify(
          loop.rotationItems || [],
          null,
          2
        );
        $("fieldLoopAdsJson").value = JSON.stringify(
          loop.sponsoredAds || [],
          null,
          2
        );
      }

      function saveLoopConfig() {
        const shuffle = $("fieldLoopShuffle").checked;
        const adFreq = toNumberOrNull($("fieldLoopAdFreq").value) || 12;

        let rotation = [];
        let ads = [];

        const rotationText = $("fieldLoopRotationJson").value.trim();
        if (rotationText) {
          try {
            const parsed = JSON.parse(rotationText);
            if (!Array.isArray(parsed))
              throw new Error("Rotation JSON must be an array.");
            rotation = parsed;
          } catch (err) {
            alert("Invalid rotation JSON: " + err.message);
            return;
          }
        }

        const adsText = $("fieldLoopAdsJson").value.trim();
        if (adsText) {
          try {
            const parsed = JSON.parse(adsText);
            if (!Array.isArray(parsed))
              throw new Error("Ads JSON must be an array.");
            ads = parsed;
          } catch (err) {
            alert("Invalid ads JSON: " + err.message);
            return;
          }
        }

        state.catalog.loopChannel = {
          shuffle,
          adFrequencyMins: adFreq,
          rotationItems: rotation,
          sponsoredAds: ads,
        };

        alert(
          "LIVE/Loop configuration saved in local catalog. Remember to export catalog.json."
        );
      }

      function addTitleToLoopRotation() {
        const select = $("fieldLoopAddTitle");
        const id = select.value;
        if (!id) return;

        const title = (state.catalog.titles || []).find((t) => t.id === id);
        if (!title) {
          alert("Title not found in catalog.");
          return;
        }

        let rotation = [];
        const rotationText = $("fieldLoopRotationJson").value.trim();
        if (rotationText) {
          try {
            const parsed = JSON.parse(rotationText);
            if (Array.isArray(parsed)) rotation = parsed;
          } catch (_) {}
        }

        rotation.push({
          refType: "title",
          refId: id,
          label: title.title || id,
        });

        $("fieldLoopRotationJson").value = JSON.stringify(rotation, null, 2);
        select.value = "";
      }

      // ------------------------------------------------------------------
      // SETTINGS VIEW
      // ------------------------------------------------------------------
      function renderSettings() {
        const settings = state.catalog.settings || {};
        $("fieldSettingsCatalogUrl").value =
          settings.catalogUrl || CATALOG_URL || "";
        $("fieldSettingsVastTag").value = settings.vastTag || "";
        $("fieldSettingsTvodBase").value = settings.tvodCheckoutBase || "";
      }

      function saveSettingsFromView() {
        const catalogUrl = $("fieldSettingsCatalogUrl").value.trim();
        const vastTag = $("fieldSettingsVastTag").value.trim();
        const tvodBase = $("fieldSettingsTvodBase").value.trim();

        state.catalog.settings = {
          catalogUrl: catalogUrl || undefined,
          vastTag: vastTag || undefined,
          tvodCheckoutBase: tvodBase || undefined,
        };

        $("envLabel").textContent = catalogUrl
          ? "Catalog configured: " + catalogUrl
          : "Catalog: local (not loaded)";

        alert(
          "Settings stored in local catalog object. Remember: frontend still reads config.json."
        );
      }

      // ------------------------------------------------------------------
      // MUX PREVIEW
      // ------------------------------------------------------------------
      function showMuxPreview(kind) {
        const id =
          kind === "content"
            ? $("fieldContentPlaybackId").value.trim()
            : $("fieldTrailerPlaybackId").value.trim();

        if (!id) {
          alert("Enter a Mux playback ID first.");
          return;
        }

        const box = $("muxPreview");
        box.classList.remove("hidden");
        box.innerHTML = `
          <div class="flex items-center justify-between gap-2 mb-2">
            <div class="text-[11px] text-white/60">
              Mux ${kind === "content" ? "Content" : "Trailer"} Preview
            </div>
            <button type="button" id="btnCloseMuxPreview" class="text-[11px] text-white/60 hover:text-white">
              Close
            </button>
          </div>
          <mux-player
            stream-type="on-demand"
            playback-id="${escHtml(id)}"
            class="w-full aspect-video rounded-lg overflow-hidden bg-black"
            autoplay
            muted
            controls
          ></mux-player>
        `;

        $("btnCloseMuxPreview").onclick = () => {
          box.classList.add("hidden");
          box.innerHTML = "";
        };
      }

      // ------------------------------------------------------------------
      // INIT
      // ------------------------------------------------------------------
      document.addEventListener("DOMContentLoaded", () => {
        // Tabs
        $("tabBtnTitles").addEventListener("click", () =>
          setActiveTab("titles")
        );
        $("tabBtnLive").addEventListener("click", () => setActiveTab("live"));
        $("tabBtnSettings").addEventListener("click", () =>
          setActiveTab("settings")
        );
        setActiveTab("titles");

        // Titles
        $("btnNewTitle").addEventListener("click", createNewTitle);
        $("btnSaveTitle").addEventListener("click", (e) => {
          e.preventDefault();
          saveTitleFromForm();
        });
        $("btnDeleteTitle").addEventListener("click", deleteCurrentTitle);
        $("filterTitles").addEventListener("input", renderTitleList);

        // Catalog load/export
        $("btnLoadCatalog").addEventListener("click", loadCatalogFromServer);
        $("btnExportCatalog").addEventListener("click", exportCatalogJson);

        // LIVE / loop
        $("btnSaveLoop").addEventListener("click", saveLoopConfig);
        $("btnLoopAddTitle").addEventListener("click", addTitleToLoopRotation);

        // Settings
        $("fieldSettingsCatalogUrl").addEventListener("change", saveSettingsFromView);
        $("fieldSettingsVastTag").addEventListener("change", saveSettingsFromView);
        $("fieldSettingsTvodBase").addEventListener("change", saveSettingsFromView);

        // Mux preview
        $("btnPreviewContent").addEventListener("click", () =>
          showMuxPreview("content")
        );
        $("btnPreviewTrailer").addEventListener("click", () =>
          showMuxPreview("trailer")
        );

        // Initial empty state
        state.catalog.titles = state.catalog.titles || [];
        renderTitleList();
        renderLoopEditor();
        renderSettings();

        $("envLabel").textContent = CATALOG_URL
          ? "Catalog configured: " + CATALOG_URL
          : "Catalog: local (not loaded)";
      });
    </script>
  </body>
</html>
